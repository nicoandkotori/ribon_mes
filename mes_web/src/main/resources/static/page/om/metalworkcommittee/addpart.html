<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>添加部件</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="../../../static/css/font.css">
    <link rel="stylesheet" href="../../../static/css/weadmin.css">
    <!-- jqgrid -->
    <link rel="stylesheet" href='../../../static/Scripts/jqgrid/css/jquery-ui.theme.min.css'/>
    <link rel="stylesheet" href='../../../static/Scripts/jqgrid/css/ui.jqgrid.css'/>
    <!-- bootstrap -->
    <link rel="stylesheet" href="../../../static/css/bootstrap.min.css">
    <!-- datepicker -->
    <link rel="stylesheet" href='../../../static/Scripts/datepicker/bootstrap-datetimepicker.css'/>
    <link rel="stylesheet" href='../../../static/Scripts/datepicker/bootstrap-datepicker.min.css'/>
    <!--easyui-->
    <link rel="stylesheet" href="../../../static/Scripts/easyui-1.7.0/themes/default/easyui.css">
    <link rel="stylesheet" href="../../../static/Scripts/easyui-1.7.0/themes/icon.css">

    <!--jquery-->
    <script src='../../../static/Scripts/jquery-1.10.2.min.js'></script>
    <script src='../../../static/Scripts/jquery.json.js'></script>
    <script src='../../../static/Scripts/Common.js'></script>
    <script src='../../../static/Scripts/Print.js'></script>
    <script src='../../../static/Scripts/lodop/LodopFuncs.js'></script>
    <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
    <!--[if lt IE 9]>
    <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
    <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="../../../lib/layui/layui.js" charset="utf-8"></script>
    <script src="../../../static/js/eleDel.js" type="text/javascript" charset="utf-8"></script>
    <!--jqgrid-->
    <script src='../../../static/Scripts/jqgrid/js/i18n/grid.locale-cn.js'></script>
    <script src='../../../static/Scripts/jqgrid/js/jquery-ui.min.js'></script>
    <script src='../../../static/Scripts/jqgrid/js/jquery.jqGrid.js'></script>
    <!-- datepicker -->
    <script src='../../../static/Scripts/datepicker/bootstrap-datepicker.js'></script>
    <script src='../../../static/Scripts/datepicker/bootstrap-datepicker.zh-CN.js'></script>
    <script src='../../../static/Scripts/datepicker/bootstrap-datetimepicker.js'></script>
    <script src='../../../static/Scripts/datepicker/bootstrap-datetimepicker.zh-CN.js'></script>
    <!--easyui-->
    <script src="../../../static/Scripts/easyui-1.7.0/jquery.easyui.min.js"></script>
    <script src="../../../static/Scripts/easyui-1.7.0/locale/easyui-lang-zh_CN.js"></script>
    <style>
        .layui-select, .layui-input {
            height: 24px;
        }
    </style>
</head>
<body>
<!--    表头-->
    <div class="weadmin-body">
        <form class="layui-form" lay-filter = "production_form">
            <div class="weadmin-block">
                <button type="button" class="layui-btn layui-btn-sm" onclick="confirmCallBack()">确认</button>
            </div>

            <div class="layui-form-item weadmin-item">

                <input type="hidden" id="recordId" name="recordId">

                <label for="cinvcode" class="weadmin-lable-sm layui-col-md1">
                    <span class="we-red">*</span>产品编码
                </label>
                <div class="layui-col-md2">
                    <input type="text" id="cinvcode" name="cinvcode" readonly class="layui-input weadmin-input-sm">
                </div>

                <label for="cinvname" class="weadmin-lable-sm layui-col-md1">
                    <span class="we-red">*</span>产品名称
                </label>
                <div class="layui-col-md2">
                    <input type="text" id="cinvname" name="cinvname" readonly class="layui-input weadmin-input-sm">
                </div>

                <label for="cinvstd" class="weadmin-lable-sm layui-col-md1">
                    <span class="we-red">*</span>规格型号
                </label>
                <div class="layui-col-md2">
                    <input type="text" id="cinvstd" name="cinvstd" readonly class="layui-input weadmin-input-sm">
                </div>



            </div>
            <div class="layui-form-item weadmin-item">
                <label for="ccomunitname" class="weadmin-lable-sm layui-col-md1">
                    <span class="we-red">*</span>单位
                </label>
                <div class="layui-col-md2">
                    <input type="text" id="ccomunitname" name="ccomunitname" readonly class="layui-input weadmin-input-sm">
                </div>

                <label for="iquantity" class="weadmin-lable-sm layui-col-md1">
                    <span class="we-red">*</span>数量
                </label>
                <div class="layui-col-md2">
                    <input type="text" id="iquantity" name="iquantity" readonly class="layui-input weadmin-input-sm">
                </div>
            </div>


        </form>
    </div>
<!--    表体-->
    <div class="weadmin-body-table">
        <button type="button" class="layui-btn layui-btn-sm" onclick="addPartRow()">增行</button>
        <button type="button" class="layui-btn layui-btn-sm layui-btn-danger" onclick="deletePartRow()">删行</button>
        <table id="part_table"></table>
        <button type="button" class="layui-btn layui-btn-sm" onclick="addMaterialRow()">增行</button>
        <button type="button" class="layui-btn layui-btn-sm layui-btn-danger" onclick="deleteMaterialRow()">删行</button>
        <table id="jqGridDetail"></table>
    </div>

</body>
<script>
    var prevEditRow, prevEditCol;
    var baseUrl = "/om/metalworkcommittee/";
    var CurRow;
    var CurCol;
    var CurRow1;
    var CurCol1;
    var rowNum = 1;
    var partRowId;
    var recordId;
    initJqgrid();
    layui.use(['form', 'admin', 'jquery', 'table', 'layer', 'laydate', 'treeSelect', "upload", 'tableSelect'], function () {
        var form = layui.form,
            admin = layui.admin,
            $ = layui.jquery,
            table = layui.table,
            layer = layui.layer,
            laydate = layui.laydate,
            treeSelect = layui.treeSelect,
            upload = layui.upload,
            tableSelect = layui.tableSelect;

    });
    initData();


    function initJqgrid() {
        $("#part_table").jqGrid({
            mtype: "GET",
            datatype: "local",
            colModel: [
                // {name: "recordId", hidden: true},
                {label: "产品表行标识",name: "recordId", width: 80,},
                // {name: "partRowId", hidden: true},
                {label: "部件表行标识",name: "partRowId", width: 80,},
                {label: "产品编码", name: "cinvcode", width: 110, sortable: false, editable: true, align: "center"},
                {label: "产品名称", name: "cinvname", width: 90, sortable: false, editable: false, align: "center"},
                {label: "规格型号", name: "cinvstd", width: 80, sortable: false, editable: false, align: "center"},
                {label: "单位", name: "ccomunitname", width: 40, sortable: false, editable: false, align: "center"},
                {label: "数量", name: "iquantity", width: 40, sortable: false, editable: true, align: "center"},
            ],
            viewrecords: true,
            multiselect: false,
            autowidth: true,
            shrinkToFit: false,
            autoScroll: true,
            scrollrows: true, // 是否显示行滚动条
            rownumbers: true,
            rowNum: 999999999,
            colMenu: false,
            cellsubmit: 'clientArray',
            cellEdit: true,
            loadBeforeSend: function (jqXHR) {
                var token = sessionStorage.getItem("mestoken");
                jqXHR.setRequestHeader('Authorization', token);

            },
            ondblClickRow: function (rowid, iRow, iCol, e) {
                if (iCol == 3 || iCol == 4) {
                    //选择自建
                    choice(rowid, "addpart_part_table");
                }
            },
            beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                CurRow = iRow;
                CurCol = iCol;
            },
            afterSaveCell: function (rowid, name, val, iRow, iCol) {
                switch (name){
                    case 'iquantity':
                        setQty(rowid);
                        break;
                    default:break;
                }
            }

        });

        $("#jqGridDetail").jqGrid({
            mtype: "GET",
            datatype: "local",
            colModel: [
                {name: "momaterialsid", key: true, hidden: true},
                {name: "modetailsid", hidden: true},
                {name: "moid", hidden: true},
                {label: "产品表行标识",name: "recordId",width:80},
                {label: "产品编码", name: "cinvcode", width: 110, sortable: false, editable: false, align: "center"},
                {label: "产品名称", name: "cinvname", width: 90, sortable: false, editable: false, align: "center"},
                {label: "规格型号", name: "cinvstd", width: 80, sortable: false, editable: false, align: "center"},
                {label: "单位", name: "ccomunitname", width: 40, sortable: false, editable: false, align: "center"},
                {label: "数量", name: "iquantity", width: 40, sortable: false, editable: false, align: "center"},
                {label: "材料单价", name: "cdefine26", width: 60, sortable: false, editable: true, align: "center"},
                {label: "单件材料费", name: "cdefine27", width: 70, sortable: false, editable: true, align: "center"},
                {label: "材料编码", name: "cinvcodes", width: 90, sortable: false, editable: true, align: "center"},

                {label: "材料名称", name: "cinvnames", width: 120, sortable: false, editable: false, align: "center"},
                {label: "材料规格", name: "cinvstds", width: 80, sortable: false, editable: false, align: "center"},

                {label: "厚度", name: "cdefine28", width: 40, sortable: false, editable: true, align: "center"},
                {label: "长", name: "cdefine29", width: 45, sortable: false, editable: true, align: "center"},
                {label: "宽", name: "cdefine30", width: 40, sortable: false, editable: true, align: "center"},
                {label: "外径", name: "cdefine31", width: 40, sortable: false, editable: true, align: "center"},
                {label: "内径", name: "cdefine32", width: 40, sortable: false, editable: true, align: "center"},
                {label: "密度", name: "cinvdefine2", width: 40, sortable: false, editable: true, align: "center"},
                {label: "下料尺寸", name: "cdefine22", width: 110, sortable: false, editable: true, align: "center"},
                {label: "单耗", name: "fbaseqtyn", width: 45, sortable: false, editable: true, align: "center"},
                {label: "总量", name: "fqtys", width: 45, sortable: false, editable: false, align: "center"},
                {label:"部件表行标识",name: "partRowId",width: 40},

            ],
            viewrecords: true,
            multiselect: false,
            autowidth: true,
            shrinkToFit: false,
            autoScroll: true,
            scrollrows: true, // 是否显示行滚动条
            rownumbers: true,
            rowNum: 999999999,
            colMenu: false,
            cellEdit: true,
            cellsubmit: 'clientArray',
            footerrow: false,//分页上添加一行，用于显示统计信息
            beforeProcessing: function (data, st, xhr) {//登录失效时请求将被拦截，提示用户：未登录
                if (data.success == false) {
                    layer.msg(data.msg);
                }
                return true;
            },
            loadBeforeSend: function (jqXHR) {
                var token = sessionStorage.getItem("mestoken");
                jqXHR.setRequestHeader('Authorization', token);

            },
            ondblClickRow: function (rowid, iRow, iCol, e) {
                //iCol==6||
                console.log(rowid);
                if (iCol == 14 || iCol == 13) {
                    //选择自建
                    choice(rowid, "2");
                }
            },

            loadComplete: function () {


            },
            afterSaveCell: function (rowid, name, val, iRow, iCol) {
//                    if (CurRow != "" || CurRow != undefined) {
//                        $("#jqGrid").jqGrid('saveCell', CurRow, CurCol);
//                    }
                if (name == 'cinvcodes') {
                    SetInventory(rowid, "2");
                } else if (name == "cdefine26" || name == "cdefine28" || name == "cdefine29" || name == "cdefine30" || name == "cdefine31" || name == "cdefine32" || name == "cinvdefine2") {
                    SetSize(rowid);
                } else if (name == "fbaseqtyn") {
                    SetIpsQuantity(rowid);
                }

            },
            onCellSelect: function (rowid, iCol, cellcontent, e) { //单击选择行


            },
            beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                CurRow1 = iRow;
                CurCol1 = iCol;


            },
            gridComplete: function () {

            }
        });
    }
    /*
     * 初始化数据，显示父页面产品表选中行的记录
     */
    function initData(){
        var selectedRowId = parent.$("#jqGrid").getGridParam("selrow");
        let selectedRowData = parent.$("#jqGrid").getRowData(selectedRowId);
        recordId = selectedRowData.recordId;
        setProductionInfo(selectedRowData);
    }

    //修改数量
    function setQty(rowid) {
        var rowData = $("#part_table").jqGrid('getRowData', rowid);
        //数量
        var fquantity = 0;
        if (rowData.iquantity != "" && rowData.iquantity != null) {
            fquantity = parseFloat(rowData.iquantity - 0).toFixed(2);
        }
        //单件加工费
        var taxmakeprice = 0;
        if (rowData.itaxprice != "" && rowData.itaxprice != null) {
            taxmakeprice = parseFloat(rowData.itaxprice - 0).toFixed(2);
        }

        //单件材料费
        var cdefine27 = 0;
        if (rowData.cdefine27 != "" && rowData.cdefine27 != null) {
            cdefine27 = parseFloat(rowData.cdefine27 - 0).toFixed(2) - 0;
        }
        //单件价格
        var tolpic = parseFloat((cdefine27 - 0) + (taxmakeprice - 0)) - 0;
        if (rowData.tolpic != "" && rowData.tolpic != null) {
            tolpic = parseFloat(rowData.tolpic - 0).toFixed(2);
        }
        //单耗
        var ipsquantity = 0;
        if (rowData.fbaseqtyn != "" && rowData.fbaseqtyn != null) {
            ipsquantity = parseFloat(rowData.fbaseqtyn - 0).toFixed(2);
        }
        $('#part_table').jqGrid('setRowData', rowid, {
            inatsum: (fquantity * taxmakeprice).toFixed(2),
            tolnum: (fquantity * tolpic).toFixed(2),
            fqtys: (fquantity * ipsquantity).toFixed(2),
            tolpic: tolpic
        });


        //循环子表更新数量
        var ids = $("#jqGridDetail").getDataIDs();
        for (var i = 0; i < ids.length; i++) {
            var rowDataDetail = $("#jqGridDetail").getRowData(ids[i]);
            if (rowDataDetail.recordId == rowData.recordId) {
                //数量
                var fquantity = 0;
                if (rowData.iquantity != "" && rowData.iquantity != null) {
                    fquantity = parseFloat(rowData.iquantity - 0).toFixed(2);
                }


                //单耗
                var ipsquantity = 0;
                if (rowDataDetail.fbaseqtyn != "" && rowDataDetail.fbaseqtyn != null) {
                    ipsquantity = parseFloat(rowDataDetail.fbaseqtyn - 0).toFixed(2);
                }
                $('#jqGridDetail').jqGrid('setRowData', ids[i], {
                    iquantity: fquantity,
                    fqtys: (fquantity * ipsquantity).toFixed(2)
                });

            }


        }
    }

    /*
     * 部件表增行函数
     */
    var partRowIndex = 0;
    function addPartRow() {
        partRowIndex = partRowIndex + 1;
        let rowData = {
            partRowId: recordId+"p" + partRowIndex,
            recordId: recordId
        };
        if (CurRow != "" || CurRow != undefined) {
            $("#part_table").jqGrid('saveCell', CurRow, CurCol);
        }
        $("#part_table").jqGrid("addRowData", partRowIndex, rowData);

    }

    /*
     * 部件表删行函数
     */
    function deletePartRow(){
        if (CurRow != "" || CurRow != undefined) {
            $("#part_table").jqGrid('saveCell', CurRow, CurCol);
        }
        let rowId = $('#part_table').jqGrid('getGridParam', 'selrow');
        if (rowId != "" && rowId != undefined) {
            $("#part_table").jqGrid("delRowData", rowId);
        }

    }

    /*
     * 材料表增行函数
     */
    function addMaterialRow(){
        partRowIndex = partRowIndex + 1;
        if (CurRow != "" || CurRow != undefined) {
            $("#part_table").jqGrid('saveCell', CurRow, CurCol);
        }
        //获取部件表选中行
        var rowid = $("#part_table").getGridParam("selrow");
        if (rowid != null && rowid != '') {
            //获取部件表选中行数据
            var rowData = $("#part_table").getRowData(rowid);
            var o = {
                mainid: rowData.mainid,
                id: rowData.id,
                recordId: rowData.recordId,
                partRowId:rowData.partRowId,
                cinvcode: rowData.cinvcode,
                cinvname: rowData.cinvname,
                cinvstd: rowData.cinvstd,
                ccomunitname: rowData.ccomunitname,
                iquantity: rowData.iquantity,
            };
            $("#jqGridDetail").addRowData(partRowIndex, o);
        } else {
            layer.alert("请先选择行再操作！");
        }
    }

    /*
     * 材料表删行函数
     */
    function deleteMaterialRow(){
        if (CurRow1 != "" || CurRow1 != undefined) {
            $("#jqGridDetail").jqGrid('saveCell', CurRow1, CurCol1);
        }
        var rowId = $('#jqGridDetail').jqGrid('getGridParam', 'selrow');
        if (rowId != "" && rowId != undefined) {
            var rowData = $("#jqGridDetail").jqGrid('getRowData', rowId);
            $("#jqGridDetail").jqGrid("delRowData", rowId);
        }
    }

    /*
     * 设置产品表头字段信息
     */
    function setProductionInfo(data){
        $("#recordId").val(data.recordId);
        $("#cinvcode").val(data.cinvcode);
        $("#cinvname").val(data.cinvname);
        $("#cinvstd").val(data.cinvstd);
        $("#ccomunitname").val(data.ccomunitname);
        $("#iquantity").val(data.iquantity);
    }


    //弹窗选择产品编码函数
    function choice(rowid, itype) {
        if (rowid != null && rowid != '') {
            WeAdminShow('选择产品', './choiceinventory.html?itype=' + itype);
        } else {
            layer.alert("请先选择行再操作！");
        }
    }

    //设置下料尺寸
    function SetSize(rowid) {
        var rowData = $("#jqGridDetail").jqGrid('getRowData', rowid);
        //数量
        var fquantity = 0;
        if (rowData.iquantity != "" && rowData.iquantity != null) {
            fquantity = parseFloat(rowData.iquantity - 0).toFixed(2);
        }


        var strSize = "";
        //厚度
        var cdefine28 = 0;
        if (rowData.cdefine28 != "" && rowData.cdefine28 != null) {
            cdefine28 = parseFloat(rowData.cdefine28 - 0).toFixed(2);
            strSize = "δ" + rowData.cdefine28;

        }
        //长
        var cdefine29 = 0;
        if (rowData.cdefine29 != "" && rowData.cdefine29 != null) {
            cdefine29 = parseFloat(rowData.cdefine29 - 0).toFixed(2);
            if (strSize != "") {
                strSize = strSize + ",";
            }
            strSize = strSize + "L" + rowData.cdefine29;

        }
        //宽
        var cdefine30 = 0;
        if (rowData.cdefine30 != "" && rowData.cdefine30 != null) {
            cdefine30 = parseFloat(rowData.cdefine30 - 0).toFixed(2);
            if (strSize != "") {
                strSize = strSize + ",";
            }
            strSize = strSize + "W" + rowData.cdefine30;
        }
        //外径
        var cdefine31 = 0;
        if (rowData.cdefine31 != "" && rowData.cdefine31 != null) {
            cdefine31 = parseFloat(rowData.cdefine31 - 0).toFixed(2);
            if (strSize != "") {
                strSize = strSize + ",";
            }
            strSize = strSize + "外φ" + rowData.cdefine31;
        }
        //内径
        var cdefine32 = 0;
        if (rowData.cdefine32 != "" && rowData.cdefine32 != null) {
            cdefine32 = parseFloat(rowData.cdefine32 - 0).toFixed(2);
            if (strSize != "") {
                strSize = strSize + ",";
            }
            strSize = strSize + "内φ" + rowData.cdefine32;
        }
        //密度
        var cinvdefine3 = 0;
        if (rowData.cinvdefine2 != "" && rowData.cinvdefine2 != null) {
            cinvdefine3 = parseFloat(rowData.cinvdefine2 - 0).toFixed(2);

        }
        var ipsquantity = ((cdefine29 * cdefine30 + 3.1415926 / 4 * (cdefine31 * cdefine31 - cdefine32 * cdefine32)) * cdefine28 / 1000000 * cinvdefine3).toFixed(2) - 0;

        $.ajax({
            type: "get",
            async: false,
            url: "/basicinfo/inventory/getbyid",
            data: {cinvcode: rowData.cinvcodes},
            success: function (data) {
                if (data != null && data != "") {

                    if ((ipsquantity == null || ipsquantity == 0 || ipsquantity == "0")) {
                        if (data.cinvdefine1 == "A" || data.cinvdefine1 == "a") {
                            ipsquantity = parseFloat((cdefine28 * cdefine29 * cdefine30 * cinvdefine3 / 1000000).toFixed(3));
                        } else if (data.cinvdefine1 == "B" || data.cinvdefine1 == "b") {
                            ipsquantity = parseFloat((cdefine29 * cinvdefine3 * (cdefine31 * cdefine31 - cdefine32 * cdefine32) * 3.1415926 / 4 / 1000000).toFixed(3));

                        } else if (data.cinvdefine1 == "C" || data.cinvdefine1 == "c") {
                            ipsquantity = parseFloat((cdefine29 / 1000).toFixed(3));
                        } else if (data.cinvdefine1 == "D" || data.cinvdefine1 == "d") {
                            ipsquantity = parseFloat((cdefine29 * cdefine30 / 1000000).toFixed(3));
                        } else if (data.cinvdefine1 == "E" || data.cinvdefine1 == "e") {
                            ipsquantity = parseFloat((cdefine29 / 1000).toFixed(3));
                        } else if (data.cinvdefine1 == "F" || data.cinvdefine1 == "f") {
                            ipsquantity = parseFloat((cdefine28 / 1000 * cdefine29 / 1000 * cdefine30 / 1000 * 1).toFixed(3));
                        } else if (data.cinvdefine1 == "G" || data.cinvdefine1 == "g") {
                            ipsquantity = parseFloat((cdefine29 / 1000 * 1).toFixed(3));
                        }


                    }

                }


            },
        });


        //材料单价
        var cdefine26 = 0;
        if (rowData.cdefine26 != "" && rowData.cdefine26 != null) {
            cdefine26 = parseFloat(rowData.cdefine26 - 0).toFixed(2);
        }

        var cdefine27 = ((ipsquantity - 0) * (cdefine26 - 0)).toFixed(2);

        $('#jqGridDetail').jqGrid('setRowData', rowid, {
            cdefine22: strSize,
            cdefine27: cdefine27,
            fbaseqtyn: (ipsquantity - 0),
            fqtys: (ipsquantity * fquantity).toFixed(2)
        });


        //循环子表合计材料单价和单件材料费
        var totalcdefine26 = 0, totalcdefine27 = 0;
        var ids = $("#jqGridDetail").getDataIDs();
        for (var i = 0; i < ids.length; i++) {
            var rowDataDetail = $("#jqGridDetail").getRowData(ids[i]);
            if (rowDataDetail.recordId == rowData.recordId) {
                totalcdefine26 = totalcdefine26 + parseFloat(rowDataDetail.cdefine26 - 0);
                totalcdefine27 = totalcdefine27 + parseFloat(rowDataDetail.cdefine27 - 0);
            }
        }

        //查询对应主表id
        var idsMain = $("#jqGrid").getDataIDs();
        var rowMainId = "";
        var rowMain = null;
        for (var i = 0; i < idsMain.length; i++) {
            var rowData1 = $("#jqGrid").getRowData(idsMain[i]);
            if (rowData1.recordId == rowData.recordId) {
                rowMainId = idsMain[i];
                rowMain = rowData1;
                break;
            }
        }
        if (rowMain != null) {
            //单件加工费
            var taxmakeprice = 0;
            if (rowMain.itaxprice != "" && rowMain.itaxprice != null) {
                taxmakeprice = parseFloat(rowMain.itaxprice - 0).toFixed(2);
            }
            var tolpic = ((totalcdefine27 - 0) + (taxmakeprice - 0)) - 0;
            $('#jqGrid').jqGrid('setRowData', rowMainId, {
                cdefine26: totalcdefine26.toFixed(2),
                cdefine27: totalcdefine27.toFixed(2),
                tolpic: tolpic,
                tolnum: (tolpic * fquantity).toFixed(2)
            });

            //需要计算主表合计
            SetTaxMakePrice(rowMainId);
        }


    }

    /*
     * 获取产品表信息
     */
    function getProductionInfo(){
        let productionObj = {
            cinvcode:$("#cinvcode").val(),
            cinvname:$("#cinvname").val(),
            cinvstd:$("#cinvstd").val(),
            ccomunitname:$("#ccomunitname").val(),
            iquantity:$("#iquantity").val(),
        };
        return productionObj;
    }

    /*
     * 获取部件表所有数据
     */
    function getPartInfos(){
        return $("#part_table").jqGrid("getRowData");
    }

    /*
     * 获取材料表所有数据
     */
    function getMaterialInfos(){
        return $("#jqGridDetail").jqGrid("getRowData");
    }

    /*
     * 带回数据
     */
    function confirmCallBack(){
        let productionInfo = getProductionInfo();
        let partInfos = getPartInfos();
        let materialInfos = getMaterialInfos();
        parent.addPartCallBack(productionInfo,partInfos,materialInfos);
        let index = parent.layer.getFrameIndex(window.name);
        //关闭当前页
        parent.layer.close(index);
    }
</script>
</html>